<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
</head>
<body>
      <div id="content" style="height:150px;line-height:150px;text-align:center; color:white;background-color:blue;font-size:80px;">
      </div>

<script type="module" >
    let num = 1;
    let content = document.getElementById('content');

    function count() {
        content.innerHTML = num++;
    };
    content.onmousemove = debounce(count,1000);

    //防抖。顾名思义，就是防止手的抖动，比如在300ms以内连续2次点击某个按钮，在某些情况下就认为它是一次点击，只会做一次请求。
    // 如果在这段 wait时间内，再次发生点击，会重新计算等待时间

        // 防抖---非立即执行。点击以后不会立即执行该函数，而是在指定的间隔时间以后，执行该函数；
        function debounce1(fun,wait){
            let timeout=null;
            return function(){
                if(timeout){ clearTimeout(timeout);}
                timeout=setTimeout(fun,wait);
            }
        }

        //防抖---立即执行。马上执行函数，在间隔指定的时间以后，再次执行才会有效果
        function debounce2(fun,wait) {
            let timeout;
            return function () {
                if (timeout) clearTimeout(timeout);
                let callNow = !timeout;
                timeout = setTimeout(() => {
                    timeout = null;
                }, wait)

                if (callNow) fun();
            }
         }

         //合并
         function debounce(fun,wait,immediate){
             let timeout=null;
             return function () {
                if(immediate){
                    if (timeout) clearTimeout(timeout);
                    let callNow = !timeout;
                
                    timeout = setTimeout(() => {
                        timeout = null;
                    }, wait)

                    if (callNow) fun();
                }else{
                    if(timeout){ clearTimeout(timeout);}
                     timeout=setTimeout(fun,wait);
                }
            }
         }

</script>
</body>
</html>